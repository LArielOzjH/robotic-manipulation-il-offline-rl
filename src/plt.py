import matplotlib.pyplot as plt
import pandas as pd
import numpy as np

# ---- Paste your CSV rows here (first 100k updates) ----
csv_text = """updates,q_min_mean,q_pi_min_mean,vae_recon_mse,pi_abs_mean,pi_l2
5000,6.6638264656066895,6.724066257476807,0.00691363587975502,0.20124685764312744,0.3760240077972412
10000,14.96246337890625,15.124807357788086,0.00356313562951982,0.20821061730384827,0.38207828998565674
15000,20.322795867919922,20.505098342895508,0.005854856688529253,0.20402757823467255,0.37943053245544434
20000,26.497060775756836,26.822904586791992,0.006358009763062,0.2116827368736267,0.38321396708488464
25000,34.28810119628906,34.70658874511719,0.0031768404878675938,0.20464608073234558,0.3738815486431122
30000,34.01005935668945,34.25244140625,0.004822915885597467,0.2099859118461609,0.3821609616279602
35000,43.6747932434082,43.92501449584961,0.00380050390958786,0.21434177458286285,0.38659238815307617
40000,47.8928337097168,48.21284103393555,0.0027814123313874006,0.2131137251853943,0.3855353593826294
45000,48.94320297241211,49.223480224609375,0.003137812949717045,0.2064061164855957,0.38118886947631836
50000,55.85401916503906,55.868064880371094,0.0038801245391368866,0.2106141448020935,0.38495123386383057
55000,58.88706970214844,59.2365608215332,0.003103641327470541,0.21313942968845367,0.3870055675506592
60000,57.653438568115234,58.28255844116211,0.005953192710876465,0.212126225233078,0.3844637870788574
65000,66.2273941040039,66.6231918334961,0.004020826891064644,0.21332702040672302,0.38678067922592163
70000,71.80138397216797,72.12655639648438,0.0027393396012485027,0.21061448752880096,0.3843441605567932
75000,70.1953353881836,70.71532440185547,0.009857277385890484,0.2086024284362793,0.3779221475124359
80000,76.41180419921875,78.3600082397461,0.007633219938725233,0.2140670269727707,0.38543108105659485
85000,71.01106262207031,71.67383575439453,0.00708781648427248,0.21067079901695251,0.38360580801963806
90000,81.30591583251953,81.88876342773438,0.0028018406592309475,0.21519038081169128,0.3883814513683319
95000,77.21542358398438,77.56745147705078,0.0030474932864308357,0.20663563907146454,0.3797638714313507
100000,77.40172576904297,77.5290756225586,0.0030105679761618376,0.21076244115829468,0.38451290130615234
"""

# ---- Load into a DataFrame ----
from io import StringIO
df = pd.read_csv(StringIO(csv_text))

# ---- Log transform small VAE MSE for visibility ----
df["log_vae_mse"] = np.log10(df["vae_recon_mse"])

# ---- Plot (single figure, mixed scales, VAE in log10) ----
plt.figure()
plt.grid(True, alpha=0.28, linewidth=0.8)
plt.plot(df["updates"], df["q_min_mean"], label="Q min mean")
plt.plot(df["updates"], df["q_pi_min_mean"], label="Q pi min mean")
plt.plot(df["updates"], df["log_vae_mse"], label="log10 VAE recon MSE")
plt.plot(df["updates"], df["pi_abs_mean"], label="Policy |a| mean")
plt.plot(df["updates"], df["pi_l2"], label="Policy L2 norm")

plt.xlabel("Training Updates")
plt.ylabel("Metric Value (mixed scale)")
plt.title("BCQ Training Metrics (first 100k updates, VAE loss in log scale)")
plt.legend()
plt.savefig("./asset/bcq_convergence.png")
plt.savefig("./asset/bcq_convergence.pdf")
plt.show()
